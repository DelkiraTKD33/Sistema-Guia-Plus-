<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuíaPlus - Sistema de Asignación de Tutores</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="guialogoo.jpg" alt="GuíaPlus Logo" class="logo">
            <h2>GuíaPlus</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#estudiantes" class="nav-item" onclick="showSection('estudiantes')">
                <i class="fas fa-user-graduate"></i>
                <span>Estudiantes</span>
            </a>
            <a href="#tutores" class="nav-item" onclick="showSection('tutores')">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Tutores</span>
            </a>
            <a href="#asignaciones" class="nav-item" onclick="showSection('asignaciones')">
                <i class="fas fa-link"></i>
                <span>Asignaciones</span>
            </a>
            <a href="#usuarios" class="nav-item" onclick="showSection('usuarios')" id="menuUsuarios" style="display: none;">
                <i class="fas fa-users-cog"></i>
                <span>Gestión de Usuarios</span>
            </a>
            <a href="#reportes" class="nav-item" onclick="showSection('reportes')">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </a>
            <a href="#configuracion" class="nav-item" onclick="showSection('configuracion')">
                <i class="fas fa-cog"></i>
                <span>Configuración</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Buscar estudiantes, tutores...">
            </div>
            <div class="header-actions">
                <button class="icon-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </button>
                <div class="user-profile" id="userProfile" style="cursor: pointer; position: relative;">
                    <img id="userAvatar" src="https://ui-avatars.com/api/?name=Admin&background=3dd9b8&color=fff" alt="Usuario">
                    <div style="display: flex; flex-direction: column; align-items: flex-start;">
                        <span id="userName">Admin</span>
                        <span id="userRole" style="font-size: 11px; opacity: 0.8;"></span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                    <div id="userDropdown" style="display: none; position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; margin-top: 10px; z-index: 1000;">
                        <a href="#" onclick="cerrarSesion(event)" style="display: block; padding: 12px 20px; color: #dc3545; text-decoration: none; border-radius: 8px; transition: background 0.2s;">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h1>Dashboard</h1>
                <p>Resumen general del sistema de tutorías</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Total Estudiantes</h3>
                        <p class="stat-number">1,248</p>
                        <span class="stat-change positive">+12% este mes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon teal">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Tutores Activos</h3>
                        <p class="stat-number">87</p>
                        <span class="stat-change positive">+5 nuevos</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <i class="fas fa-link"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Asignaciones</h3>
                        <p class="stat-number">642</p>
                        <span class="stat-change neutral">14 pendientes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Tasa de Éxito</h3>
                        <p class="stat-number">92%</p>
                        <span class="stat-change positive">+3% este mes</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Asignaciones Recientes</h3>
                        <button class="btn-text">Ver todas</button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Estudiante</th>
                                    <th>Tutor</th>
                                    <th>Materia</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>María García</td>
                                    <td>Dr. Juan Pérez</td>
                                    <td>Matemáticas</td>
                                    <td>15/11/2025</td>
                                    <td><span class="status-badge active">Activa</span></td>
                                </tr>
                                <tr>
                                    <td>Carlos López</td>
                                    <td>Dra. Ana Martínez</td>
                                    <td>Física</td>
                                    <td>14/11/2025</td>
                                    <td><span class="status-badge active">Activa</span></td>
                                </tr>
                                <tr>
                                    <td>Laura Sánchez</td>
                                    <td>Prof. Roberto Silva</td>
                                    <td>Química</td>
                                    <td>13/11/2025</td>
                                    <td><span class="status-badge pending">Pendiente</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Tutores Destacados</h3>
                    </div>
                    <div class="tutor-list">
                        <div class="tutor-item">
                            <img src="https://ui-avatars.com/api/?name=Juan+Perez&background=1e3a5f&color=fff" alt="Tutor">
                            <div class="tutor-info">
                                <h4>Dr. Juan Pérez</h4>
                                <p>Matemáticas • 25 estudiantes</p>
                                <div class="rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span>5.0</span>
                                </div>
                            </div>
                        </div>
                        <div class="tutor-item">
                            <img src="https://ui-avatars.com/api/?name=Ana+Martinez&background=3dd9b8&color=fff" alt="Tutor">
                            <div class="tutor-info">
                                <h4>Dra. Ana Martínez</h4>
                                <p>Física • 18 estudiantes</p>
                                <div class="rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span>4.8</span>
                                </div>
                            </div>
                        </div>
                        <div class="tutor-item">
                            <img src="https://ui-avatars.com/api/?name=Roberto+Silva&background=1e3a5f&color=fff" alt="Tutor">
                            <div class="tutor-info">
                                <h4>Prof. Roberto Silva</h4>
                                <p>Química • 22 estudiantes</p>
                                <div class="rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span>4.9</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Estudiantes Section -->
        <section id="estudiantes" class="content-section">
            <div class="section-header">
                <div>
                    <h1>Gestión de Estudiantes</h1>
                    <p>Administra los estudiantes del sistema</p>
                </div>
                <button class="btn-primary" onclick="openModal('modalEstudiante')">
                    <i class="fas fa-plus"></i> Agregar Estudiante
                </button>
            </div>

            <div class="card">
                <div class="card-filters">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar estudiante...">
                    </div>
                    <select class="filter-select">
                        <option>Todas las carreras</option>
                        <option>Ingeniería</option>
                        <option>Medicina</option>
                        <option>Derecho</option>
                    </select>
                    <select class="filter-select">
                        <option>Todos los semestres</option>
                        <option>1er Semestre</option>
                        <option>2do Semestre</option>
                        <option>3er Semestre</option>
                        <option>4to Semestre</option>
                        <option>5to Semestre</option>
                        <option>6to Semestre</option>
                        <option>7mo Semestre</option>
                        <option>8vo Semestre</option>
                        <option>9no Semestre</option>
                        <option>10mo Semestre</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Carrera</th>
                                <th>Semestre</th>
                                <th>Email</th>
                                <th>Tutor Asignado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="estudiantesTable">
                            <tr>
                                <td>EST001</td>
                                <td>
                                    <div class="user-cell">
                                        <img src="https://ui-avatars.com/api/?name=Maria+Garcia&background=3dd9b8&color=fff" alt="Estudiante">
                                        <span>María García</span>
                                    </div>
                                </td>
                                <td>Ingeniería de Sistemas</td>
                                <td>3er Semestre</td>
                                <td>maria.garcia@uni.edu</td>
                                <td>Dr. Juan Pérez</td>
                                <td>
                                    <button class="btn-icon" title="Editar"><i class="fas fa-edit"></i></button>
                                    <button class="btn-icon" title="Ver"><i class="fas fa-eye"></i></button>
                                    <button class="btn-icon danger" title="Eliminar"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EST002</td>
                                <td>
                                    <div class="user-cell">
                                        <img src="https://ui-avatars.com/api/?name=Carlos+Lopez&background=1e3a5f&color=fff" alt="Estudiante">
                                        <span>Carlos López</span>
                                    </div>
                                </td>
                                <td>Medicina</td>
                                <td>2do Semestre</td>
                                <td>carlos.lopez@uni.edu</td>
                                <td>Dra. Ana Martínez</td>
                                <td>
                                    <button class="btn-icon" title="Editar"><i class="fas fa-edit"></i></button>
                                    <button class="btn-icon" title="Ver"><i class="fas fa-eye"></i></button>
                                    <button class="btn-icon danger" title="Eliminar"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td>EST003</td>
                                <td>
                                    <div class="user-cell">
                                        <img src="https://ui-avatars.com/api/?name=Laura+Sanchez&background=3dd9b8&color=fff" alt="Estudiante">
                                        <span>Laura Sánchez</span>
                                    </div>
                                </td>
                                <td>Derecho</td>
                                <td>1er Semestre</td>
                                <td>laura.sanchez@uni.edu</td>
                                <td><span class="status-badge pending">Sin asignar</span></td>
                                <td>
                                    <button class="btn-icon" title="Editar"><i class="fas fa-edit"></i></button>
                                    <button class="btn-icon" title="Ver"><i class="fas fa-eye"></i></button>
                                    <button class="btn-icon danger" title="Eliminar"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination">
                    <button class="btn-pagination" disabled><i class="fas fa-chevron-left"></i></button>
                    <button class="btn-pagination active">1</button>
                    <button class="btn-pagination">2</button>
                    <button class="btn-pagination">3</button>
                    <button class="btn-pagination"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </section>

        <!-- Tutores Section -->
        <section id="tutores" class="content-section">
            <div class="section-header">
                <div>
                    <h1>Gestión de Tutores</h1>
                    <p>Administra los tutores del sistema</p>
                </div>
                <button class="btn-primary" onclick="abrirCrearTutor()">
                    <i class="fas fa-plus"></i> Agregar Tutor
                </button>
            </div>

            <div class="tutores-grid">
                <div class="tutor-card">
                    <div class="tutor-card-header">
                        <img src="https://ui-avatars.com/api/?name=Juan+Perez&background=1e3a5f&color=fff" alt="Tutor">
                        <span class="status-badge active">Disponible</span>
                    </div>
                    <div class="tutor-card-body">
                        <h3>Dr. Juan Pérez</h3>
                        <p class="specialty">Matemáticas y Cálculo</p>
                        <div class="tutor-stats">
                            <div class="stat">
                                <i class="fas fa-users"></i>
                                <span>25 estudiantes</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-calendar"></i>
                                <span>5 años exp.</span>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span>5.0</span>
                        </div>
                    </div>
                    <div class="tutor-card-footer">
                        <button class="btn-secondary">Ver Perfil</button>
                        <button class="btn-primary">Asignar</button>
                    </div>
                </div>

                <div class="tutor-card">
                    <div class="tutor-card-header">
                        <img src="https://ui-avatars.com/api/?name=Ana+Martinez&background=3dd9b8&color=fff" alt="Tutor">
                        <span class="status-badge active">Disponible</span>
                    </div>
                    <div class="tutor-card-body">
                        <h3>Dra. Ana Martínez</h3>
                        <p class="specialty">Física y Termodinámica</p>
                        <div class="tutor-stats">
                            <div class="stat">
                                <i class="fas fa-users"></i>
                                <span>18 estudiantes</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-calendar"></i>
                                <span>8 años exp.</span>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span>4.8</span>
                        </div>
                    </div>
                    <div class="tutor-card-footer">
                        <button class="btn-secondary">Ver Perfil</button>
                        <button class="btn-primary">Asignar</button>
                    </div>
                </div>

                <div class="tutor-card">
                    <div class="tutor-card-header">
                        <img src="https://ui-avatars.com/api/?name=Roberto+Silva&background=1e3a5f&color=fff" alt="Tutor">
                        <span class="status-badge busy">Ocupado</span>
                    </div>
                    <div class="tutor-card-body">
                        <h3>Prof. Roberto Silva</h3>
                        <p class="specialty">Química Orgánica</p>
                        <div class="tutor-stats">
                            <div class="stat">
                                <i class="fas fa-users"></i>
                                <span>22 estudiantes</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-calendar"></i>
                                <span>6 años exp.</span>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span>4.9</span>
                        </div>
                    </div>
                    <div class="tutor-card-footer">
                        <button class="btn-secondary">Ver Perfil</button>
                        <button class="btn-primary" disabled>Asignar</button>
                    </div>
                </div>

                <div class="tutor-card">
                    <div class="tutor-card-header">
                        <img src="https://ui-avatars.com/api/?name=Carmen+Rodriguez&background=3dd9b8&color=fff" alt="Tutor">
                        <span class="status-badge active">Disponible</span>
                    </div>
                    <div class="tutor-card-body">
                        <h3>Lic. Carmen Rodríguez</h3>
                        <p class="specialty">Literatura y Redacción</p>
                        <div class="tutor-stats">
                            <div class="stat">
                                <i class="fas fa-users"></i>
                                <span>15 estudiantes</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-calendar"></i>
                                <span>4 años exp.</span>
                            </div>
                        </div>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                            <span>4.5</span>
                        </div>
                    </div>
                    <div class="tutor-card-footer">
                        <button class="btn-secondary">Ver Perfil</button>
                        <button class="btn-primary">Asignar</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Asignaciones Section -->
        <section id="asignaciones" class="content-section">
            <div class="section-header">
                <div>
                    <h1>Asignaciones de Tutorías</h1>
                    <p>Gestiona las asignaciones entre estudiantes y tutores</p>
                </div>
                <button class="btn-primary" onclick="abrirCrearAsignacion()">
                    <i class="fas fa-plus"></i> Nueva Asignación
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Asignaciones Activas</h3>
                    <div class="card-filters">
                        <select id="filtroEstadoAsignacion" class="filter-select">
                            <option value="">Todas</option>
                            <option value="activa">Activas</option>
                            <option value="completada">Completadas</option>
                            <option value="pendiente">Pendientes</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Estudiante</th>
                                <th>Tutor</th>
                                <th>Materia</th>
                                <th>Fecha Inicio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="asignacionesTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <i class="fas fa-spinner fa-spin"></i> Cargando asignaciones...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Gestión de Usuarios Section -->
        <section id="usuarios" class="content-section">
            <div class="section-header">
                <div>
                    <h1>Gestión de Usuarios</h1>
                    <p>Administrar usuarios y roles del sistema</p>
                </div>
                <button class="btn-primary" onclick="openModal('modalUsuario')">
                    <i class="fas fa-user-plus"></i>
                    Nuevo Usuario
                </button>
            </div>

            <!-- Estadísticas de Usuarios -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e74c3c;">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Administradores</h3>
                        <p class="stat-number" id="statsAdmins">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #f39c12;">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Coordinadores</h3>
                        <p class="stat-number" id="statsCoordinadores">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #3498db;">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Tutores</h3>
                        <p class="stat-number" id="statsTutores">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #2ecc71;">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Estudiantes</h3>
                        <p class="stat-number" id="statsEstudiantesUsuarios">0</p>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="card-filters">
                <select id="filtroRolUsuarios">
                    <option value="">Todos los roles</option>
                    <option value="admin">Administradores</option>
                    <option value="coordinador">Coordinadores</option>
                    <option value="tutor">Tutores</option>
                    <option value="estudiante">Estudiantes</option>
                </select>
                <select id="filtroEstadoUsuarios">
                    <option value="">Todos los estados</option>
                    <option value="true">Activos</option>
                    <option value="false">Inactivos</option>
                </select>
            </div>

            <!-- Tabla de Usuarios -->
            <div class="data-table-container">
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Especialidad/Carrera</th>
                                <th>Estado</th>
                                <th>Último Acceso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usuariosTable">
                            <!-- Los usuarios se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Reportes Section -->
        <section id="reportes" class="content-section">
            <div class="section-header">
                <div>
                    <h1>Reportes y Estadísticas</h1>
                    <p>Análisis detallado del sistema de tutorías</p>
                </div>
                <div class="section-actions">
                    <button class="btn-secondary" onclick="exportarReporte('pdf')">
                        <i class="fas fa-file-pdf"></i> Exportar PDF
                    </button>
                    <button class="btn-secondary" onclick="exportarReporte('excel')">
                        <i class="fas fa-file-excel"></i> Exportar Excel
                    </button>
                    <button class="btn-primary" onclick="generarReporte()">
                        <i class="fas fa-sync-alt"></i> Actualizar Datos
                    </button>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="reportes-kpis" id="reportesKpis">
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(61,217,184,0.15); color: #3dd9b8;">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiTotalEstudiantes">0</span>
                        <span class="kpi-label">Total Estudiantes</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(30,58,95,0.15); color: #1e3a5f;">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiTotalTutores">0</span>
                        <span class="kpi-label">Total Tutores</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(46,204,113,0.15); color: #2ecc71;">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiCompletadas">0</span>
                        <span class="kpi-label">Finalizadas</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(52,152,219,0.15); color: #3498db;">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiActivas">0</span>
                        <span class="kpi-label">Activas</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(243,156,18,0.15); color: #f39c12;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiTiempoPromedio">0</span>
                        <span class="kpi-label">Meses Promedio</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon" style="background: rgba(155,89,182,0.15); color: #9b59b6;">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="kpi-data">
                        <span class="kpi-valor" id="kpiTotalAsignaciones">0</span>
                        <span class="kpi-label">Total Asignaciones</span>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <div class="reports-controls">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-filter"></i> Filtros de Reporte</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo de Reporte</label>
                                <select id="tipoReporte" class="form-control">
                                    <option value="general">Reporte General</option>
                                    <option value="asignaciones">Asignaciones</option>
                                    <option value="tutores">Rendimiento de Tutores</option>
                                    <option value="estudiantes">Estudiantes por Carrera</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Período</label>
                                <select id="periodoReporte" class="form-control">
                                    <option value="mes">Este Mes</option>
                                    <option value="trimestre">Este Trimestre</option>
                                    <option value="semestre">Este Semestre</option>
                                    <option value="anio">Este Año</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha Desde</label>
                                <input type="date" id="fechaDesde" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Fecha Hasta</label>
                                <input type="date" id="fechaHasta" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráficos Row 1 -->
            <div class="reports-grid">
                <div class="card">
                    <div class="card-header" style="flex-direction: column; align-items: flex-start;">
                        <h3><i class="fas fa-chart-line"></i> Asignaciones por Mes</h3>
                        <p style="margin: 4px 0 0; font-size: 0.82rem; color: #6c757d; font-weight: 400;">Cantidad de nuevas asignaciones tutor-estudiante creadas en cada uno de los últimos 6 meses</p>
                    </div>
                    <div id="assignmentsChartInfo" style="padding: 0 1rem; display: flex; gap: 1rem; flex-wrap: wrap;"></div>
                    <div class="chart-container">
                        <canvas id="assignmentsChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="flex-direction: column; align-items: flex-start;">
                        <h3><i class="fas fa-chart-pie"></i> Distribución por Carrera</h3>
                        <p style="margin: 4px 0 0; font-size: 0.82rem; color: #6c757d; font-weight: 400;">Proporción de estudiantes registrados en el sistema según su carrera universitaria</p>
                    </div>
                    <div id="careersChartInfo" style="padding: 0 1rem; display: flex; gap: 1rem; flex-wrap: wrap;"></div>
                    <div class="chart-container">
                        <canvas id="careersChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Gráficos Row 2 -->
            <div class="reports-grid" style="margin-top: 2rem;">
                <div class="card">
                    <div class="card-header" style="flex-direction: column; align-items: flex-start;">
                        <h3><i class="fas fa-chart-bar"></i> Estado de Asignaciones</h3>
                        <p style="margin: 4px 0 0; font-size: 0.82rem; color: #6c757d; font-weight: 400;">Distribución actual de todas las asignaciones según su estado: activas, finalizadas, en espera o canceladas</p>
                    </div>
                    <div id="estadoChartInfo" style="padding: 0 1rem; display: flex; gap: 1rem; flex-wrap: wrap;"></div>
                    <div class="chart-container">
                        <canvas id="estadoChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="flex-direction: column; align-items: flex-start;">
                        <h3><i class="fas fa-medal"></i> Rendimiento de Tutores</h3>
                        <p style="margin: 4px 0 0; font-size: 0.82rem; color: #6c757d; font-weight: 400;">Porcentaje de asignaciones completadas por cada tutor, ordenados del mejor al menor desempeño</p>
                    </div>
                    <div class="tutor-performance" style="padding: 1rem;">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Tabla de asignaciones recientes -->
            <div style="margin-top: 2rem;">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Asignaciones Recientes</h3>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Estudiante</th>
                                    <th>Tutor</th>
                                    <th>Materia</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                    <th>Progreso</th>
                                </tr>
                            </thead>
                            <tbody id="reportesAsignacionesRecientes">
                                <tr><td colspan="7" style="text-align:center; padding:20px;">Cargando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Resumen General -->
            <div style="margin-top: 2rem;">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-check"></i> Resumen General</h3>
                    </div>
                    <div class="summary-stats">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuración Section -->
        <section id="configuracion" class="content-section">
            <div class="section-header">
                <h1>Configuración del Sistema</h1>
                <p>Ajusta las preferencias y parámetros del sistema</p>
            </div>

            <div class="settings-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>Configuración General</h3>
                    </div>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Nombre de la Universidad</label>
                            <input type="text" value="Universidad Nacional" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Máximo de estudiantes por tutor</label>
                            <input type="number" value="25" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Duración máxima de tutoría (meses)</label>
                            <input type="number" value="6" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Idioma del sistema</label>
                            <select class="form-control">
                                <option>Español</option>
                                <option>Inglés</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Notificaciones</h3>
                    </div>
                    <div class="settings-form">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Notificaciones por email</h4>
                                <p>Recibir alertas de nuevas asignaciones</p>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Recordatorios de sesiones</h4>
                                <p>Enviar recordatorios antes de las tutorías</p>
                            </div>
                            <label class="toggle">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Reportes semanales</h4>
                                <p>Recibir resumen de actividades</p>
                            </div>
                            <label class="toggle">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Seguridad</h3>
                    </div>
                    <div class="settings-form">
                        <div class="form-group">
                            <label>Cambiar contraseña</label>
                            <input type="password" placeholder="Contraseña actual" class="form-control">
                            <input type="password" placeholder="Nueva contraseña" class="form-control">
                            <input type="password" placeholder="Confirmar contraseña" class="form-control">
                        </div>
                        <button class="btn-primary">Actualizar Contraseña</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Respaldo de Datos</h3>
                    </div>
                    <div class="backup-options">
                        <button class="btn-secondary">
                            <i class="fas fa-download"></i>
                            Descargar Respaldo
                        </button>
                        <button class="btn-secondary">
                            <i class="fas fa-upload"></i>
                            Restaurar Respaldo
                        </button>
                        <button class="btn-primary">
                            <i class="fas fa-sync"></i>
                            Respaldo Automático
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Acciones del Sistema</h3>
                </div>
                <div class="system-actions">
                    <button class="btn-primary"><i class="fas fa-save"></i> Guardar Configuración</button>
                    <button class="btn-secondary"><i class="fas fa-undo"></i> Restablecer Valores</button>
                    <button class="btn-danger"><i class="fas fa-exclamation-triangle"></i> Limpiar Caché</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Agregar Estudiante -->
    <div id="modalEstudiante" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Nuevo Estudiante</h2>
                <button class="modal-close" onclick="closeModal('modalEstudiante')">&times;</button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>ID Estudiante *</label>
                            <input type="text" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Carrera *</label>
                            <select class="form-control" required>
                                <option value="">Seleccionar...</option>
                                <option>Ingeniería de Sistemas</option>
                                <option>Medicina</option>
                                <option>Derecho</option>
                                <option>Administración</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Semestre *</label>
                            <select id="estudianteSemestre" class="form-control" required>
                                <option value="">Seleccionar...</option>
                                <option value="1er Semestre">1er Semestre</option>
                                <option value="2do Semestre">2do Semestre</option>
                                <option value="3er Semestre">3er Semestre</option>
                                <option value="4to Semestre">4to Semestre</option>
                                <option value="5to Semestre">5to Semestre</option>
                                <option value="6to Semestre">6to Semestre</option>
                                <option value="7mo Semestre">7mo Semestre</option>
                                <option value="8vo Semestre">8vo Semestre</option>
                                <option value="9no Semestre">9no Semestre</option>
                                <option value="10mo Semestre">10mo Semestre</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Observaciones</label>
                        <textarea class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('modalEstudiante')">Cancelar</button>
                <button class="btn-primary">Guardar Estudiante</button>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Tutor -->
    <div id="modalTutor" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTutorTitulo">Agregar Nuevo Tutor</h2>
                <button class="modal-close" onclick="closeModal('modalTutor')">&times;</button>
            </div>
            <div class="modal-body">
                <form>
                    <input type="hidden" id="tutorId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="tutorNombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="tutorEmail" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Especialidad *</label>
                            <input type="text" id="tutorEspecialidad" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="tutorTelefono" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Capacidad máxima de estudiantes</label>
                        <input type="number" id="tutorCapacidad" class="form-control" value="10" min="1">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('modalTutor')">Cancelar</button>
                <button class="btn-primary" onclick="guardarTutor()">Guardar Tutor</button>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Asignación -->
    <div id="modalAsignacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nueva Asignación de Tutoría</h2>
                <button class="modal-close" onclick="closeModal('modalAsignacion')">&times;</button>
            </div>
            <div class="modal-body">
                <form>
                    <input type="hidden" id="asignacionId">
                    <div class="form-group">
                        <label>Seleccionar Estudiante *</label>
                        <select id="selectEstudianteAsignacion" class="form-control" required>
                            <option value="">-- Seleccionar estudiante --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Seleccionar Tutor *</label>
                        <select id="selectTutorAsignacion" class="form-control" required>
                            <option value="">-- Seleccionar tutor --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Materia o Tema *</label>
                        <input type="text" id="inputMateriaAsignacion" class="form-control" placeholder="Ej: Cálculo II" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha de Inicio *</label>
                            <input type="date" id="inputFechaAsignacion" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Estado</label>
                            <select id="inputEstadoAsignacion" class="form-control">
                                <option value="Activa">Activa</option>
                                <option value="En espera">En espera</option>
                                <option value="Finalizada">Finalizada</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Progreso (%)</label>
                        <input type="number" id="inputProgresoAsignacion" class="form-control" value="0" min="0" max="100">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('modalAsignacion')">Cancelar</button>
                <button class="btn-primary" onclick="guardarAsignacion()">Crear Asignación</button>
            </div>
        </div>
    </div>

    <!-- Modal Gestión de Usuario -->
    <div id="modalUsuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalUsuarioTitulo">Nuevo Usuario</h2>
                <button class="modal-close" onclick="closeModal('modalUsuario')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formUsuario">
                    <input type="hidden" id="usuarioId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Username *</label>
                            <input type="text" id="usuarioUsername" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Contraseña *</label>
                            <input type="password" id="usuarioPassword" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="usuarioNombre" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="usuarioEmail" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="tel" id="usuarioTelefono" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Rol *</label>
                            <select id="usuarioRol" class="form-control" required onchange="mostrarCamposRol()">
                                <option value="">Seleccionar rol...</option>
                                <option value="admin">Administrador</option>
                                <option value="coordinador">Coordinador</option>
                                <option value="tutor">Tutor</option>
                                <option value="estudiante">Estudiante</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Tutor -->
                    <div id="camposTutor" style="display: none;">
                        <div class="form-group">
                            <label>Especialidad *</label>
                            <input type="text" id="usuarioEspecialidad" class="form-control" placeholder="Ej: Matemáticas y Ciencias">
                        </div>
                        <div class="form-group">
                            <label>Capacidad de Estudiantes</label>
                            <input type="number" id="usuarioCapacidad" class="form-control" value="15" min="1" max="50">
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Estudiante -->
                    <div id="camposEstudiante" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Carrera *</label>
                                <input type="text" id="usuarioCarrera" class="form-control" placeholder="Ej: Ingeniería de Sistemas">
                            </div>
                            <div class="form-group">
                                <label>Semestre *</label>
                                <select id="usuarioSemestre" class="form-control">
                                    <option value="">Seleccionar...</option>
                                    <option value="1er Semestre">1er Semestre</option>
                                    <option value="2do Semestre">2do Semestre</option>
                                    <option value="3er Semestre">3er Semestre</option>
                                    <option value="4to Semestre">4to Semestre</option>
                                    <option value="5to Semestre">5to Semestre</option>
                                    <option value="6to Semestre">6to Semestre</option>
                                    <option value="7mo Semestre">7mo Semestre</option>
                                    <option value="8vo Semestre">8vo Semestre</option>
                                    <option value="9no Semestre">9no Semestre</option>
                                    <option value="10mo Semestre">10mo Semestre</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Campos específicos para Coordinador -->
                    <div id="camposCoordinador" style="display: none;">
                        <div class="form-group">
                            <label>Especialidad</label>
                            <input type="text" id="usuarioEspecialidadCoord" class="form-control" placeholder="Ej: Coordinación Académica">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('modalUsuario')">Cancelar</button>
                <button class="btn-primary" onclick="guardarUsuario()">Guardar Usuario</button>
            </div>
        </div>
    </div>

    <script>
        // Verificar autenticación al cargar la página
        async function verificarSesion() {
            try {
                const response = await fetch('/api/auth/session');
                const data = await response.json();

                if (!data.autenticado) {
                    window.location.href = '/login';
                    return;
                }

                const usuario = data.usuario;
                usuarioActual = usuario;

                document.getElementById('userName').textContent = usuario.nombre;
                document.getElementById('userRole').textContent = usuario.rol.toUpperCase();

                const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(usuario.nombre)}&background=3dd9b8&color=fff`;
                document.getElementById('userAvatar').src = avatarUrl;

                configurarInterfazPorRol();

                const seccionesIniciales = {
                    admin: 'dashboard',
                    coordinador: 'dashboard',
                    tutor: 'estudiantes',
                    estudiante: 'asignaciones'
                };
                showSection(seccionesIniciales[usuario.rol] || 'dashboard');

            } catch (error) {
                console.error('Error verificando sesión:', error);
                window.location.href = '/login';
            }
        }

        // Toggle del dropdown del usuario
        document.addEventListener('DOMContentLoaded', () => {
            const userProfile = document.getElementById('userProfile');
            const userDropdown = document.getElementById('userDropdown');

            if (userProfile && userDropdown) {
                userProfile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userDropdown.style.display = userDropdown.style.display === 'none' ? 'block' : 'none';
                });

                document.addEventListener('click', () => {
                    userDropdown.style.display = 'none';
                });
            }

            verificarSesion();
        });
    </script>
    <script src="api.js"></script>
    <script src="script.js"></script>
    <script src="asignaciones-tutores-funcionalidad.js"></script>
    <script src="usuarios-funcionalidad.js"></script>
    <script src="reportes-nuevas.js"></script>
</body>
</html>
